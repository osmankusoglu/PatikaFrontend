;/*FB_PKG_DELIM*/

__d("LSGetFirstAvailableAdminMessageCTAID",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(a){return b.sequence([function(a){return b.db.table(27).fetchDesc([[[]],"ctaId"]).next().then(function(a,d){var e=a.done;a=a.value;return e?c[0]=b.i64.cast([0,1]):(d=a.item,c[0]=b.i64.add(d.ctaId,b.i64.cast([0,1])))})},function(a){return d[0]=c[0]}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSApplyAdminMessageCTA",["LSArrayGetObjectAt","LSDeserializeFromJsonIntoDictionaryV2.nop","LSGetFirstAvailableAdminMessageCTAID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetFirstAvailableAdminMessageCTAID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(27).put({threadKey:a[0],messageId:a[2],ctaId:d[0],timestampMs:a[1],adClientToken:a[5],adPreferenceUrl:a[6],adHelpUrl:a[7],showAdChoiceIcon:a[8],title:a[3],actionUrl:a[9],adminMessageNicknameParticipantId:a[10],targetId:a[11],targetTitle:a[12]})},function(e){return c.filter(c.db.table(12).fetch([[[a[2]]],"messageId"]),function(b){return a[2]===b.messageId&&c.i64.eq(a[0],b.threadKey)}).next().then(function(a,e){var f=a.done;a=a.value;return f?d[1]=void 0:(e=a.item,c.sequence([function(a){return d[7]=e.metadataDataclass,d[7]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),d[7]).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[9]=d[8].get("sticker"),d[8],d[9]?d[10]=!1:d[10]=!0,d[10]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[9].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[9].get(d[45]),d[9],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("sticker",d[41])}])},function(a){return d[11]=d[8].get("word_effects"),d[8],d[11]?d[12]=!1:d[12]=!0,d[12]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[11].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=d[11].get(d[53]),d[11],d[41].set(d[53],d[55])}])}):c.resolve()},function(a){return d[44]=d[41].get("magic_word_offsets"),d[41],d[45]=c.createArray(),d[46]=c.i64.of_int32(d[44].length),c.i64.gt(d[46],c.i64.cast([0,0]))?c.loopAsync(d[46],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[44],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=(d[45].push(d[53]),d[45])}])}):c.resolve()},function(a){return d[41].set("magic_word_offsets",d[45]),d[47]=d[41].get("magic_word_lengths"),d[41],d[48]=c.createArray(),d[49]=c.i64.of_int32(d[47].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[52]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[47],d[52]).then(function(a){return a=a,d[53]=a[0],d[54]=a[1],a})},function(a){return d[55]=(d[48].push(d[53]),d[48])}])}):c.resolve()},function(a){return d[41].set("magic_word_lengths",d[48]),d[50]=d[41].get("magic_word_emojis"),d[41],d[50]?d[51]=!1:d[51]=!0,d[51]?c.resolve():c.sequence([function(a){return d[52]=c.createArray(),d[53]=c.i64.of_int32(d[50].length),c.i64.gt(d[53],c.i64.cast([0,0]))?c.loopAsync(d[53],function(a){return d[54]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[50],d[54]).then(function(a){return a=a,d[55]=a[0],d[56]=a[1],a})},function(a){return d[57]=(d[52].push(d[55]),d[52])}])}):c.resolve()},function(a){return d[41].set("magic_word_emojis",d[52])}])},function(a){return d[8].set("word_effects",d[41])}])},function(a){return d[13]=d[8].get("ig_avatar_sticker"),d[8],d[13]?d[14]=!1:d[14]=!0,d[14]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[13].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[13].get(d[45]),d[13],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("ig_avatar_sticker",d[41])}])},function(a){return d[15]=d[8].get("power_up"),d[8],d[15]?d[16]=!1:d[16]=!0,d[16]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[15].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[15].get(d[45]),d[15],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("power_up",d[41])}])},function(a){return d[17]=d[8].get("ai_bot"),d[8],d[17]?d[18]=!1:d[18]=!0,d[18]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[17].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[17].get(d[45]),d[17],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("ai_bot",d[41])}])},function(a){return d[19]=d[8].get("pobox"),d[8],d[19]?d[20]=!1:d[20]=!0,d[20]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[19].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[19].get(d[45]),d[19],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("pobox",d[41])}])},function(a){return d[21]=d[8].get("video"),d[8],d[21]?d[22]=!1:d[22]=!0,d[22]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[21].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[21].get(d[45]),d[21],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("video",d[41])}])},function(a){return d[23]=d[8].get("text_translation"),d[8],d[23]?d[24]=!1:d[24]=!0,d[24]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[23].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[23].get(d[45]),d[23],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("text_translation",d[41])}])},function(a){return d[25]=d[8].get("memories"),d[8],d[25]?d[26]=!1:d[26]=!0,d[26]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[25].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[25].get(d[45]),d[25],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("memories",d[41])}])},function(a){return d[27]=d[8].get("command"),d[8],d[27]?d[28]=!1:d[28]=!0,d[28]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[27].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[27].get(d[45]),d[27],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("command",d[41])}])},function(a){return d[29]=d[8].get("admin_message"),d[8],d[29]?d[30]=!1:d[30]=!0,d[30]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[29].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[29].get(d[45]),d[29],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("admin_message",d[41])}])},function(a){return d[31]=d[8].get("misinfo_metadata"),d[8],d[31]?d[32]=!1:d[32]=!0,d[32]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[31].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[31].get(d[45]),d[31],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("misinfo_metadata",d[41])}])},function(a){return d[33]=d[8].get("forwarded_message"),d[8],d[33]?d[34]=!1:d[34]=!0,d[34]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[33].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[33].get(d[45]),d[33],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("forwarded_message",d[41])}])},function(a){return d[35]=d[8].get("ai_metadata"),d[8],d[35]?d[36]=!1:d[36]=!0,d[36]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[35].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[35].get(d[45]),d[35],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("ai_metadata",d[41])}])},function(a){return d[37]=d[8].get("encrypted_message"),d[8],d[37]?d[38]=!1:d[38]=!0,d[38]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[37].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=d[37].get(d[52]),d[37],d[41].set(d[52],d[54])}])}):c.resolve()},function(a){return d[44]=d[41].get("toplevel_payload"),d[41],d[45]=new c.Map(),d[46]=d[44].keys(),d[47]=c.i64.of_int32(d[46].length),c.i64.gt(d[47],c.i64.cast([0,0]))?c.loopAsync(d[47],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[46],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=d[44].get(d[52]),d[44],d[45].set(d[52],d[54])}])}):c.resolve()},function(a){return d[41].set("toplevel_payload",d[45]),d[48]=d[41].get("supplemental_payloads"),d[41],d[49]=c.createArray(),d[50]=c.i64.of_int32(d[48].length),c.i64.gt(d[50],c.i64.cast([0,0]))?c.loopAsync(d[50],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=new c.Map(),d[55]=d[52].keys(),d[56]=c.i64.of_int32(d[55].length),c.i64.gt(d[56],c.i64.cast([0,0]))?c.loopAsync(d[56],function(a){return d[61]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[55],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=d[52].get(d[62]),d[52],d[54].set(d[62],d[64])}])}):c.resolve()},function(a){return d[57]=d[54].get("encrypted_supplemental_payload"),d[54],d[58]=new c.Map(),d[59]=d[57].keys(),d[60]=c.i64.of_int32(d[59].length),c.i64.gt(d[60],c.i64.cast([0,0]))?c.loopAsync(d[60],function(a){return d[61]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[59],d[61]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return d[64]=d[57].get(d[62]),d[57],d[58].set(d[62],d[64])}])}):c.resolve()},function(a){return d[54].set("encrypted_supplemental_payload",d[58]),d[61]=(d[49].push(d[54]),d[49])}])}):c.resolve()},function(a){return d[41].set("supplemental_payloads",d[49]),d[8].set("encrypted_message",d[41])}])},function(a){return d[39]=d[8].get("rich_text"),d[8],d[39]?d[40]=!1:d[40]=!0,d[40]?c.resolve():c.sequence([function(a){return d[41]=new c.Map(),d[42]=d[39].keys(),d[43]=c.i64.of_int32(d[42].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[42],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[39].get(d[45]),d[39],d[41].set(d[45],d[47])}])}):c.resolve()},function(a){return d[8].set("rich_text",d[41])}])},function(a){return d[6]=d[8]}]):c.resolve((d[8]=new c.Map(),d[6]=d[8]))},function(a){return d[1]=d[6]}]))})},function(b){return d[1]?d[3]=!1:d[3]=!0,d[3]?0:(d[6]=new c.Map(),d[6].set("ad_client_token",a[5]),d[6].set("ad_preference_url",a[6]),d[6].set("ad_help_url",a[7]),d[6].set("show_ad_choice_icon",a[8]),d[6].set("title",a[3]),d[6].set("action_url",a[9]),d[6].set("admin_message_nickname_participant_id",c.i64.to_string(a[10])),d[6].set("target_id",c.i64.to_string(a[11])),d[6].set("target_title",a[12]),d[6].set("identifier_name",void 0),d[1].set("admin_message",d[6])),d[1]?d[4]=!1:d[4]=!0,d[4]?d[5]=void 0:(d[6]=c.toJSON(d[1]),d[5]=d[6]),c.forEach(c.filter(c.db.table(12).fetch([[[a[0],a[1],a[2]]]]),function(b){return c.i64.eq(b.threadKey,a[0])&&c.i64.eq(c.i64.cast([0,0]),c.i64.cast([0,0]))&&c.i64.eq(b.timestampMs,a[1])&&b.messageId===a[2]}),function(b){var c=b.update;b.item;return c({adminMsgCtaId:d[0],adminMsgCtaTitle:a[3],adminMsgCtaType:a[4],metadataDataclass:d[5]})})}])},function(a){return c.resolve(e)}])}e.exports=a}),null);